# ‚ö° Circuit Breaker (–†–∞–∑–º—ã–∫–∞—Ç–µ–ª—å —Ü–µ–ø–∏) –Ω–∞ Go

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è **Circuit Breaker** –Ω–∞ —è–∑—ã–∫–µ Go. –ú–µ—Ö–∞–Ω–∏–∑–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç —Å–µ—Ä–≤–∏—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–∞—Å–∫–∞–¥–Ω—ã—Ö —Å–±–æ–µ–≤ –∏ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –∑–∞–≤–∏—Å–∏–º—ã–π —Å–µ—Ä–≤–∏—Å.

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
Circuit_Breaker/
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îú‚îÄ‚îÄ client/         # HTTP-–∫–ª–∏–µ–Ω—Ç, –æ–±—ë—Ä–Ω—É—Ç—ã–π –≤ Circuit Breaker
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îÇ   ‚îî‚îÄ‚îÄ server/         # –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã–π HTTP-—Å–µ—Ä–≤–µ—Ä
‚îÇ       ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ pkg/
‚îÇ   ‚îî‚îÄ‚îÄ circuitbreaker/ # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Circuit Breaker
‚îÇ       ‚îî‚îÄ‚îÄ breaker.go
‚îú‚îÄ‚îÄ go.mod              # –ú–æ–¥—É–ª—å Go
‚îî‚îÄ‚îÄ README.md
```

---

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

–û—Ç–∫—Ä–æ–π –¥–≤–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞.

### 1. –ó–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä:

```bash
go run ./cmd/server
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç —Å–ª—É—à–∞—Ç—å –Ω–∞ `localhost:8081/hello`. –û–Ω –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Å–±–æ–∏ ‚Äî —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é 50% –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `500 Internal Server Error`.

### 2. –ó–∞–ø—É—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç:

```bash
go run ./cmd/client
```

–ö–ª–∏–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –∫–∞–∂–¥—ã–µ 1 —Å–µ–∫—É–Ω–¥—É, –∏—Å–ø–æ–ª—å–∑—É—è –æ–±—ë—Ä—Ç–∫—É Circuit Breaker. –ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Ä—è–¥ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –ø—Ä–µ–≤—ã—à–∞–µ—Ç –ø–æ—Ä–æ–≥, –¥–∞–ª—å–Ω–µ–π—à–∏–µ –≤—ã–∑–æ–≤—ã –≤—Ä–µ–º–µ–Ω–Ω–æ –±–ª–æ–∫–∏—Ä—É—é—Ç—Å—è.

---

## üõ† –ú–µ—Ö–∞–Ω–∏–∑–º Circuit Breaker

–ú–æ–¥—É–ª—å `pkg/circuitbreaker` —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é –æ–±—ë—Ä—Ç–∫—É `Breaker`, –ø—Ä–∏–Ω–∏–º–∞—é—â—É—é —Ñ—É–Ω–∫—Ü–∏—é `Circuit`:

```go
type Circuit func(ctx context.Context) (string, error)

func Breaker(circuit Circuit, failureThreshold uint) Circuit
```

–ï—Å–ª–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ **–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –Ω–µ—É–¥–∞—á** ‚â• `failureThreshold`, Circuit Breaker **–æ—Ç–∫–ª—é—á–∞–µ—Ç** –≤—ã–∑–æ–≤—ã –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å:

```text
"service unreachable: circuit breaker is open"
```

–ß–µ—Ä–µ–∑ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ **—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è** (2, 4, 8, 16 —Å–µ–∫ –∏ —Ç.–¥.) –æ–Ω –ø—Ä–æ–±—É–µ—Ç —Å–Ω–æ–≤–∞. –£—Å–ø–µ—à–Ω—ã–π –≤—ã–∑–æ–≤ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫.

---

## üñ• –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞:

```text
[0] –û—Ç–≤–µ—Ç: "", –û—à–∏–±–∫–∞: unexpected status code: 500
[1] –û—Ç–≤–µ—Ç: "Hello, world!\n"
...
[27] –û—Ç–≤–µ—Ç: "", –û—à–∏–±–∫–∞: unexpected status code: 500
[28] –û—Ç–≤–µ—Ç: "", –û—à–∏–±–∫–∞: service unreachable: circuit breaker is open
[29] –û—Ç–≤–µ—Ç: "Hello, world!\n"
```

## üõ∞ –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞ —Å–µ—Ä–≤–µ—Ä–∞:

```text
[0] –û—Ç–≤–µ—Ç: "internal error"
[1] –û—Ç–≤–µ—Ç: "Hello, world!"
...
[28] –û—Ç–≤–µ—Ç: "Hello, world!"
```

---

## üìå –ü–æ–ª–µ–∑–Ω–æ –∑–Ω–∞—Ç—å

- Circuit Breaker –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–µ–Ω –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ, –≥–¥–µ –æ—Ç–∫–∞–∑ –æ–¥–Ω–æ–π —Å–ª—É–∂–±—ã –º–æ–∂–µ—Ç –ø–æ–≤–ª–µ—á—å –ª–∞–≤–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π —Å–±–æ–π –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –ø–æ–¥ –¥—Ä—É–≥–∏–µ –≤—ã–∑–æ–≤—ã: –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, gRPC, Redis –∏ —Ç. –¥.

---

## ‚úÖ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–æ–º –ø—Ä–æ–µ–∫—Ç–µ:

```go
breaker := circuitbreaker.Breaker(myFunc, 3)

for {
    result, err := breaker(context.Background())
    if err != nil {
        log.Println("–û—à–∏–±–∫–∞:", err)
        continue
    }
    fmt.Println("–†–µ–∑—É–ª—å—Ç–∞—Ç:", result)
}
```

---

## üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏

- [Cloud Native Go Matthew A. Titmus](https://ftp.zhirov.kz/books/IT/Go/–û–±–ª–∞—á–Ω—ã–π%20Go%20%28–ú.–ê.%20–¢–∏—Ç–º—É—Å%29.pdf) ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Circuit Breaker.
- [Go net/http Documentation](https://pkg.go.dev/net/http)

---
